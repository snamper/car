<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>我的收藏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../css/mui.min.css">
    <link rel="stylesheet" href="../../../css/common.css">
</head>
<style>
    .sw-payList:after{
        left: 0;
    }
    .sw-header-liebiao{
        display: inline-block;background: url(../../../image/person/repair/icon_liebiao.png) no-repeat;width: 21px;height: 21px;background-size:contain ;margin-bottom: 0;background-position: center;
    }
    .sw-header-ditu{
        display: inline-block;background: url(../../../image/person/repair/icon_ditu@3x.png) no-repeat;width: 21px;height: 21px;background-size:contain ;margin-bottom: 0;background-position: center;
    }
    .sw-rafter:after{
        content: '';
        height: 24px;
        background: #EFEFEF;
        margin-top: 9px;
        width: 1px;
        float: right;
    }


    .sw-after-no:after{
        height: 0;
    }

    .sw-title-box{
        width: 100%;height: 42px;
    }
    .sw-title-1{
        width: 33.3%;float: left;text-align: center;line-height: 42px;font-size: 14px;color: #FFFFFF;
    }
    .sw-header{
        display: inline-block;margin-bottom: 0;color: #FFFFFF;
    }
    .sw-header.active{
        border-bottom: 2px solid #FFFFFF;
    }

    /*店铺*/
    .sw-dp-img1{
        width: 110px!important;max-width:110px!important;height: 110px!important;
    }
    .sw-dp-date{
        font-size: 14px;
    }
    .sw-text1{
        margin-left: 36px;margin-top: -20px;color: #666666;font-size: 12px;
    }
    .sw-renz-img{
        width: 16px;vertical-align: middle;margin-left: 4px;
    }

    .sw-biao-lei{
        display:inline-block;
        float: right;
        font-size: 10px;
        height: 18px;
        line-height: 18px;
        padding: 0 4px;
        border-radius: 9px;
        position: absolute;
        top: 0;
        right: 0;
    }
    /*蓝色*/
    .sw-biao-lei1{
        border: 1px solid #3EB7FF;
        color: #3EB7FF;
    }
    /*绿色*/
    .sw-biao-lei2{
        border: 1px solid #18C839;
        color: #18C839;
    }
    /*粉色*/
    .sw-biao-lei3{
        border: 1px solid #FF6699;
        color: #FF6699;
    }
    .sw-dp-cuBox3{
        height: 110px;
        white-space: normal;
        color: #000000;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
        word-break: break-all;
        padding-top: 24px;
    }

    /*圈子*/
    .sw-input-box{
        width: 100%;background: #EFEFEF!important;padding-top: 10px;text-align: center;z-index: 1;border-bottom: 1px solid #DDDDDD;
    }
    .sw-input-phone{
        text-align: left;
        height: 40px!important;
        background-size: 16px;
        padding-left: 24px!important;
        padding-right: 42px!important;
        width:96%!important;
        margin-bottom: 10px!important;
        border-radius: 24px!important;
    }
    .sw-input-zx{
        position: absolute;right: 42px;top: 22px;width: 24px;height: 24px;
    }
    .sw-card-header{
        padding-right: 10%!important;
    }
    .sw-card-header:after{
        background: none!important;
    }
    .sw-card-body{
        background: #f5f5f5;margin-top: 4px;border: 1px solid #DDDDDD;border-radius: 6px;padding: 10px;
    }
    .sw-coterie-imgBox:before,.sw-coterie-imgBox:after{
        height: 0;
    }
    .sw-card-cuBox3{
        height: 60px;
        white-space: normal;
        color: #000000;
        overflow-y: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        word-break: break-all;
        font-size: 16px;
        line-height: 32px!important;
    }

    .sheying:active{
        width: 46px!important;
    }
    .sw-coterie-box{
        background: #FFFFFF;margin-bottom: 20px;
    }
    .sw-face{
        border-radius: 50%;
    }
    .sw-nickName{
        color:#FF534C;line-height: 24px;
    }
    .sw-table-text1{
        color: #333333;line-height: 18px;
    }
    .sw-dingwei-img{
        width: 16px!important;vertical-align: top;margin-right: 4px;
    }

    .sw-del-box{
        width: 50%;float: left;line-height: 24px;
    }
    .sw-del-text{
        font-size: 13px;color: #FF534C;margin-left: 16px
    }

    .sw-like-box{
        width: 50%;float: right;line-height: 24px;text-align: right;
    }
    .sw-like-img{
        height: 15px!important;width:17px!important;vertical-align: text-bottom;margin-right: 4px;
    }
    .sw-pj-img{
        height: 15px!important;width:17px!important;vertical-align: text-bottom;margin-right: 4px;
    }

    .sw-card-li{
        background: #e9e9e9;width: 90%;padding: 10px 12px;
    }
    .sw-card-img1{
        height: 60px!important;max-width: 60px!important;
    }
    .sw-csl-div1{
        width: 100%;padding: 0 15px;margin-top: 10px;display: block;
    }
    .sw-csl-div2{
        background: #FFFFFF;border: #DDDDDD 1px solid;
    }
    .sw-csl-div3{
        padding: 8px;
    }
    .sw-csl-div4{
        padding-left: 106px;display:block;position: relative;margin-top:-104px;width: 100%;
    }
    .sw-csl-p1{
        font-size: 14px;line-height: 28px;margin-bottom: 0;width: 100%;
    }
    .sw-csl-p2{
        font-size: 12px;line-height: 24px;margin-bottom: 0;width: 100%;
    }
    .sw-search-p{
        background: url(../../../image/index/icon_wz_sousuo@3x.png)no-repeat;
        width: 45px;
        height: 36px;
        margin: 0!important;
        background-size: 17px;
        position: absolute;
        top: 11px;
        background-position: center;
        margin-top: -50px;
        right: 16px;

    }
    .sw-box-3{
        padding-right: 170px;
        display: inline-block;
        position: absolute;
        max-width: 100%;
    }
    .sw-box-4{
        display: inline-block;max-width: 100%;position: relative;
    }
    .sw-box-5{
        display: inline-block;max-width: 100%;color: #666666;
    }
    .sw-renz{
        background: url(../../../image/person/renzheng2.png) no-repeat;background-size: 16px;background-position: right 1px;padding-right:18px;
    }
    .sw-renv{
        background: url(../../../image/person/renzheng.png) no-repeat;background-size: 16px;background-position: right 1px;padding-right:18px;
    }

    .mui-pull-bottom-tips {
        text-align: center;
        background-color: #efeff4;
        font-size: 15px;
        line-height: 40px;
        color: #777;
    }


    /*店铺*/
    .sw-dp-img1{
        width: 110px!important;max-width:110px!important;height: 110px!important;
    }
    .sw-dp-date{
        font-size: 14px;
    }
    .sw-text1{
        margin-left: 36px;margin-top: -20px;color: #666666;font-size: 12px;word-break: break-all;
    }
    .sw-renz-img{
        width: 16px;vertical-align: middle;margin-left: 4px;
    }

    .sw-biao-lei{
        display:inline-block;
        float: right;
        font-size: 10px;
        height: 18px;
        line-height: 18px;
        padding: 0 4px;
        border-radius: 9px;
        position: absolute;
        top: 0;
        right: 0;
    }
    /*蓝色*/
    .sw-biao-lei1{
        border: 1px solid #3EB7FF;
        color: #3EB7FF;
    }
    /*绿色*/
    .sw-biao-lei2{
        border: 1px solid #18C839;
        color: #18C839;
    }
    /*粉色*/
    .sw-biao-lei3{
        border: 1px solid #FF6699;
        color: #FF6699;
    }
    .sw-dp-cuBox3{
        height: 110px;
        white-space: normal;
        color: #000000;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
        word-break: break-all;
        padding-top: 24px;
    }

    .sw-box-3{
        padding-right: 170px;
        display: inline-block;
        position: absolute;
        max-width: 100%;
    }
    .sw-box-4{
        display: inline-block;max-width: 100%;position: relative;
    }
    .sw-box-5{
        display: inline-block;max-width: 100%;color: #666666;
    }
    .sw-renz{
        background: url(../../../image/person/renzheng2.png) no-repeat;background-size: 16px;background-position: right 1px;padding-right:18px;
    }
    .sw-renv{
        background: url(../../../image/person/renzheng.png) no-repeat;background-size: 16px;background-position: right 1px;padding-right:18px;
    }
    .sw-renv-renz{
        background: url(../../../image/person/renzv-renz.png) no-repeat;background-size: 36px;background-position: right 1px;padding-right:38px;
    }
</style>
<body>
<header class="mui-bar mui-bar-nav">
    <a class="mui-icon mui-icon-left-nav mui-pull-left"  onclick="openView('../../../view/person/index.html','person_index','pop-in');"></a>
    <h1 class="mui-title">
        <div id="sliderSegmentedControl" style="width: 180px;margin: auto;background: none;top: 6px;" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
            <div class="mui-scroll">
                <a class="mui-control-item" id="store"  style="color: #FFFFFF;border-bottom: none;padding: 0 15px;">
                    店铺
                </a>
                <a class="mui-control-item" id="product" style="color: #FFFFFF;border-bottom: none;padding: 0 15px;">
                    产品
                </a>
                <a class="mui-control-item" href="#item3mobile" style="color: #FFFFFF;border-bottom: none;padding: 0 15px;">
                    圈子
                </a>
            </div>
        </div>
        <div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-4" style="width: 40px;z-index: 2;margin: auto;-webkit-transform: translate(-60px);background: #FFFFFF;margin-top: 4px;"></div>
    </h1>
    <a class="mui-icon mui-pull-right" id="headerLie">
        <p class="sw-header-liebiao" onclick="goSearch()"></p>
    </a>
</header>
<div class="mui-content">
    <div id="slider" class="mui-slider mui-fullscreen">
        <div class="mui-slider-group">
            <div id="item3mobile" class="mui-slider-item mui-control-content mui-active">
                <div class="mui-scroll-wrapper">
                    <input type="number" name="circlePage" id="circlePage" value="1" hidden="hidden"/>
                    <div class="mui-scroll" id="circleLoadList">
                        <div class="mui-input-row sw-input-box">
                            <input type="text" placeholder="输入关键字搜索"  id="keyWord" style="font-size:14px;color: #666;" maxlength="17" class="sw-input-phone">
                            <p class="sw-search-p" onclick="circleSrearch()"></p>
                        </div>
                        <div id="circleList" style="background: #FFFFFF;">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--圈子模板-->
<script id="circle-list-tpl" type="text/html">
    {{# var len = d.length }}
    {{# for(var i = 0;i < len; i++){ }}
    <div class="mui-card-header mui-card-media sw-card-header" id="circle_{{ d[i].id }}">
        <img src="{{ imgUrl+d[i].head_pic }}" class="sw-face" style="width: 40px;height: 40px;"/>
        <div class="mui-media-body">
            <span class="sw-nickName">{{ d[i].uname }}</span>
            <p class="sw-table-text1" style="word-break: break-all;">{{ d[i].content }}</p>
            {{# if(d[i].circle_type==2){ }}
            <ul class="mui-table-view sw-coterie-imgBox" style="margin: 10px 0;">
                <li class="mui-table-view-cell mui-media sw-card-li">
                    <a href="javascript:;">
                        <img class="mui-media-object mui-pull-left sw-card-img1" src="{{ imgUrl+d[i].face_pic }}">
                        <div class="mui-media-body sw-card-cuBox3">
                            {{ d[i].companyname }}
                        </div>
                    </a>
                </li>
            </ul>
            {{# }else{ }}

            <ul class="mui-table-view mui-grid-view sw-coterie-imgBox" style="margin-left: -12px;">
                {{# for(var j=0,len2=d[i].imgs.length;j<len2;j++){ }}
                <li class="mui-table-view-cell mui-media mui-col-xs-4">
                    <img class="mui-media-object" src="{{ imgUrl+d[i].imgs[j] }}" data-preview-src="{{ imgUrl+d[i].imgs[j] }}" data-preview-group="{{ d[i].id }}" width="100%" height="{{ imgH }}px" style="height: {{ imgH }}px;">
                </li>
                {{# } }}
            </ul>

            {{# } }}
            <p style="color: #FF534C!important;">
                <img src="../../../image/coterie/dingwei.png" class="sw-dingwei-img"/>{{ d[i].area }}
            </p>
            <div style="width: 100%;">
                <p class="sw-del-box">
                    {{ d[i].create_time }}
                    {{# if(d[i].can_delete){ }}
                    <span class="sw-del-text" onclick="delCircle('{{ d[i].id }}','{{ d[i].type }}','{{ d[i].fu_id }}')">删除</span>
                    <input type="number" name="delStatus{{ d[i].id }}" id="delStatus{{ d[i].id }}" value="1" hidden="hidden" />
                    {{# } }}
                </p>
                <p class="sw-like-box">
					<span style="margin-right: 32px;">
						{{# if(d[i].is_collect){ }}
						<img src="../../../image/coterie/icon_dt_like_r.png" class="sw-like-img" id="like_this_{{ d[i].id }}" onclick="collectCircle('{{ d[i].id }}',0)"/>
						{{# }else{ }}
						<img src="../../../image/coterie/icon_dt_like.png" class="sw-like-img" id="like_this_{{ d[i].id }}"  onclick="collectCircle('{{ d[i].id }}',1)"/>
						{{# } }}
						<span id="circle_collect_{{ d[i].id }}">{{ d[i].collection }}</span>
					</span>
                    <span id="detail">
						<img src="../../../image/coterie/icon_dt_pingjia.png" class="sw-pj-img" onclick="pinglun22('{{ d[i].id  }}')"/>{{ d[i].comments }}
					</span>
                </p>
            </div>

            <div style="clear: both;"></div>
        </div>
    </div>
    {{# mui.previewImage(); } }}
</script>

<script type="text/javascript" src="../../../js/mui.min.js"></script>
<script type="text/javascript" src="../../../js/global.js"></script>
<script type="text/javascript" src="../../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../../js/laytpl/laytpl.js"></script>
<script type="text/javascript" src="../../../js/mui.pullToRefresh.js"></script>
<script type="text/javascript" src="../../../js/mui.pullToRefresh.material.js"></script>
<script type="text/javascript" src="../../../js/mui.previewimage.js?v=1.0.6"></script>
<script type="text/javascript" src="../../../js/mui.zoom.js"></script>
<script type="text/javascript">
    var imgH = parseInt((document.body.clientWidth-120)/3);
    $(function() {

        $("#headerLie").show();
        $("#sliderProgressBar").css('-webkit-transform','translate(66px)');//    transform:  translateZ(0px);

        (function($) {
            //阻尼系数
            var deceleration = mui.os.ios?0.003:0.009;
            $('.mui-scroll-wrapper').scroll({
                bounce: false,
                indicators: true, //是否显示滚动条
                deceleration:deceleration
            });

            $.ready(function() {
                loadCircle();
            });
        })(mui);

    })


    /**
     * 加载圈子信息
     */
    function loadCircle(){

        mui("#circleLoadList").pullToRefresh({
            up: {
                auto: true,
                offset: 50, //距离底部高度(到达该高度即触发)
                contentnomore: '没有更多收藏圈子了',
                contentrefresh:'<i class="mui-spinner" style="vertical-align: sub;height: 18px;width: 18px;margin-right: 4px;"></i>正在加载...',
                callback: function() {
                    circleEle = this;
                    var page = mui("#circlePage")[0].value;//获取页数
                    var keyWord = $.trim(mui("#keyWord")[0].value);//获取关键字

                    var data = {};
                    var postData = {};
                    //请求的数据

                    postData.page     = page;//请求的页码
                    postData.keyword  = keyWord;//请求的页码

                    postData.pageSize = 10;//每页显示数量
                    postData.token    = JsonStorage.getItem('token');
                    postData.userType = JsonStorage.getItem('userType');	//2为业务员

                    postData.dos  = 'collect';
                    //页面相关数据
                    data.mod      = 'api.sev.circle';//模型
                    data.fun      = 'getCircleDateList';//方法
                    data.tpl      = 'circle-list-tpl';//列表模板
                    data.listId   = 'circleList';//列表容器

                    data.pageId   = 'circlePage';//页码Id

                    data.postData = postData;

                    setTimeout(function(){
                        //请求并处理数据
                        loadInfoArr(data,true,circleEle);
                    },300)
                }
            }
        });

    }

    //消息列表
    function pinglun22(n){
        openView('../../../view/coterie/coterieDetail.html','detail','pop-in',{vid:n});
    }
    //删除圈子
    function delCircle(n,t,f){
        mui.confirm('确认删除？删除后不可恢复', '&nbsp;', ['<span class="mui-popup-button mui-btn sw-popu-btn" style="color:#333">确认</span>','<span class="mui-popup-button mui-btn mui-btn-blue sw-popu-btn">取消</span>' ], function(e) {
            if (e.index == 1) {//确认
                var delId = "#delStatus"+n;
                if($(delId).val()==1){
                    $(delId).val(0)
                    //加载弹窗

                    var postData      = {};
                    postData.id       = n;
                    postData.ty       = t;
                    postData.fu       = f;
                    postData.token    = JsonStorage.getItem('token');
                    postData.userType = JsonStorage.getItem('userType');	//2为业务员

                    if(UserInfo.has_login()==false){
                        sw.toast('请重新登录');
                        return
                    }
                    //如果已经登陆 获取登录后的数据
                    http.load('api.sev.circle','delSelfCircle',postData,function(rData){//请求成功
                        //关闭加载框
                        closeLoading();
                        sw.toast(rData.msg);
                        if(rData.status==200){//保存成功
                            //下架成功从列表移除
                            var conId = '#circle_'+n;
                            $(conId).remove();
                        }else{
                            $(delId).val(1)
                        }
                    },function(xhr,type,errorThrown){//请求失败
                        $(delId).val(1)
                        //无网络提示
                        sw.toast('请求失败，服务器或网络异常');
                    })
                }
            }
        },'div')
        $('.mui-popup-button').css('font-size','16px');
    }

    //取消收藏
    function collectCircle(n,t) {
        if(UserInfo.has_login()==false){
            sw.toast('请重新登录');
            return
        }
        var postData      = {};
        postData.id       = n;
        postData.type     = t;
        postData.token    = JsonStorage.getItem('token');
        postData.userType = JsonStorage.getItem('userType');	//2为业务员
        //如果已经登陆 获取登录后的数据
        http.load('api.sev.circle','collectCircle',postData,function(rData){//请求成功
            //关闭加载框
            closeLoading();
            sw.toast(rData.msg);
            if(rData.status==200){//保存成功
                if(t===1){
                    $('#like_this_'+n).attr('onclick','collectCircle('+n+',0)').attr('src','../../../image/coterie/icon_dt_like_r.png');
                    $('#circle_collect_'+n).html(parseInt($('#circle_collect_'+n).html())+1);
                }else {
                    $('#like_this_'+n).attr('src','../../../image/coterie/icon_dt_like.png');
                    setTimeout(function(){
                        //下架成功从列表移除
                        var conId = '#circle_'+n;
                        $(conId).remove();
                    },500)
                }
            }
        },function(xhr,type,errorThrown){//请求失败
            $(delId).val(1)
            //无网络提示
            sw.toast('请求失败，服务器或网络异常');
        })
    }

    //圈子搜索
    function circleSrearch(){
        mui("#circlePage")[0].value = 1;//获取页数
        $("#circleList").html('');
        circleEle.refresh(true);
        circleEle.pullUpLoading(true);
    }


    /**
     *加载数据
     * @param inData 数据
     * @param isLogin 判断是否需要登录
     *
     */
    function loadInfoArr(inData,isLogin,self){
//	sw.jcon(inData)
        var postData = inData.postData;
        var mod      = inData.mod;//模型
        var fun      = inData.fun;//方法
        var tpl      = inData.tpl;//列表模板
        var listId   = inData.listId;//列表容器
        var pageId   = inData.pageId;//页码Id

        var isload = true;
        if(isLogin){//需要判断是否登录
            //监控页面是否登录
            if(UserInfo.has_login()==false){
                isload = false;
            }
        }

        if(isload){
            //如果已经登陆 获取登录后的数据
            http.load(mod,fun,postData,function(rData){//请求成功

                if(rData.status==200){

                    //将数据输出到页面
                    var data   = rData.list;
                    sw.jcon(rData)
                    var payTpl = $('#'+tpl).html();
                    laytpl(payTpl).render(data,function(render){
                        $('#'+listId).append(render);
                    });

                    //处理加载逻辑
                    var count    = parseInt(rData.count);//数据总条数
                    var page     = parseInt(rData.page);
                    var pageSize = parseInt(rData.pageSize);
                    var showLen  = page*pageSize;//统计当前应该显示多少条

                    //判断条数是否足够
                    if(count<=showLen){//加载动图隐藏
                        self.endPullUpToRefresh(true); //参数为true代表没有更多数据了。
                    }else{
                        self.endPullUpToRefresh(false);
                        $("#"+pageId).val(page+1);
                    }
                    //如果条数为 0 出现提示语言
                    if(count==0&&page==1){
                        self.endPullUpToRefresh(true); //参数为true代表没有更多数据了。
                    }

                }else{
                    sw.toast(rData.msg);
                    self.endPullUpToRefresh(true);
                }

            },function(xhr,type,errorThrown){//请求失败
                //无网络提示
                sw.toast('请求数据失败，请检查网络后重试');
                self.endPullUpToRefresh(true);
            })
        }
    }

    mui("#store")[0].addEventListener('tap',function(){	//收藏记录
        var postData = {'productType':'','keyword':'','groupId':''};
        openView('../../../view/person/collect/index.html','person_collect_index','pop-in',postData);
    })
    mui("#product")[0].addEventListener('tap',function(){	//收藏记录
        var postData = {'productType':'','keyword':'','groupId':''};
        openView('../../../view/person/collect/indexProduct.html','person_collect_index','pop-in',postData);
    })
</script>
</body>

</html>